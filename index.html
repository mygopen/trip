<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>é¦–çˆ¾è‡ªç”±è¡Œå°å¹«æ‰‹ | Seoul Trip Assistant</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts: Only Noto Sans TC as requested -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #f3f4f6;
            overflow-x: hidden;
            -webkit-tap-highlight-color: transparent;
        }

        /* No scrollbar utility */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        .app-shell {
            max-width: 480px;
            margin: 0 auto;
            background: #ffffff;
            min-height: 100vh;
            position: relative;
            box-shadow: 0 0 20px rgba(0,0,0,0.05);
            padding-bottom: 80px;
        }

        .timeline-line {
            position: absolute;
            left: 1.25rem;
            top: 0;
            bottom: 0;
            width: 2px;
            background-color: #e5e7eb;
            z-index: 0;
        }

        .fade-in { animation: fadeIn 0.3s ease-out forwards; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Custom Banner Styles */
        .glass-card {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .text-shadow {
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }

        /* Tab Styling */
        .tab-btn {
            transition: all 0.2s ease;
        }
        .tab-active {
            background-color: white;
            color: #ec4899; /* pink-500 */
            border: 2px solid #fce7f3; /* pink-100 */
            box-shadow: 0 4px 12px rgba(236, 72, 153, 0.15);
            transform: translateY(-2px);
        }
        .tab-inactive {
            background-color: #f9fafb; /* gray-50 */
            color: #9ca3af; /* gray-400 */
            border: 1px solid transparent;
        }

        .nav-item-active { color: #ec4899; }
        .nav-item-inactive { color: #9ca3af; }

        /* Toast Notification */
        #toast {
            visibility: hidden;
            min-width: 250px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 8px;
            padding: 12px;
            position: fixed;
            z-index: 100;
            left: 50%;
            bottom: 90px;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s, bottom 0.3s;
        }
        #toast.show {
            visibility: visible;
            opacity: 1;
            bottom: 100px;
        }
    </style>
</head>
<body>

    <div class="app-shell flex flex-col">
        
        <!-- Header (Sticky) -->
        <header class="sticky top-0 z-50 bg-white/95 backdrop-blur-sm shadow-sm px-4 py-3 flex justify-between items-center">
            <div class="flex items-center gap-2">
                <div class="bg-pink-500 text-white p-1.5 rounded-lg shadow-sm">
                    <i class="fa-solid fa-plane-departure"></i>
                </div>
                <h1 class="text-lg font-bold text-gray-800 tracking-wide">é¦–çˆ¾è‡ªç”±è¡Œ</h1>
            </div>
            <!-- Info Button -->
            <button id="headerInfoBtn" onclick="toggleInfoModal()" class="text-gray-400 hover:text-pink-500 transition">
                <i class="fa-solid fa-circle-info text-xl"></i>
            </button>
        </header>

        <!-- Views Container -->
        <div id="viewContainer" class="flex-1 relative">
            
            <!-- VIEW 1: Itinerary (è¡Œç¨‹) -->
            <div id="view-itinerary" class="view-section fade-in">
                <div id="itineraryBanner"></div>
                <div class="sticky top-[60px] z-40 bg-white/95 backdrop-blur-sm border-b border-gray-100 shadow-sm pt-2 pb-2">
                    <div class="flex overflow-x-auto no-scrollbar px-3 py-1 gap-2" id="dayTabs"></div>
                </div>
                <div class="p-4 pb-20" id="itineraryContent"></div>
            </div>

            <!-- VIEW 2: Guide (å°è¦½) -->
            <div id="view-guide" class="view-section hidden fade-in bg-gray-50 min-h-full p-4">
                <div class="text-center mb-6 pt-4">
                    <h2 class="text-2xl font-bold text-pink-500 mb-2">æ™¯é»å°è¦½</h2>
                    <p class="text-sm text-gray-500">é¦–çˆ¾å¿…å»ç†±é–€æ™¯é»æƒ…å ±</p>
                </div>
                <div id="guideContent" class="space-y-6 pb-24"></div>
            </div>

            <!-- VIEW 3: Translation (ç¿»è­¯) -->
            <div id="view-translation" class="view-section hidden fade-in p-4 bg-gray-50 min-h-full">
                <div class="text-center mb-6 pt-4">
                    <h2 class="text-2xl font-bold text-pink-500 mb-2">æ—…éŠç¿»è­¯</h2>
                    <p class="text-sm text-gray-500">ä¸­æ–‡ Â· English Â· í•œêµ­ì–´</p>
                </div>
                <div class="bg-white p-5 rounded-xl shadow-sm border-2 border-pink-100 mb-6 bg-gradient-to-br from-pink-50/50 to-blue-50/50">
                    <h3 class="font-bold text-gray-800 mb-3 flex items-center gap-2 text-lg">
                        <span class="text-2xl">âœ¨</span> å³æ™‚ç¿»è­¯
                    </h3>
                    <div class="space-y-3">
                        <div>
                            <label class="text-sm text-gray-500 mb-1 block">è¼¸å…¥ä¸­æ–‡</label>
                            <textarea id="transInput" placeholder="è«‹è¼¸å…¥æƒ³ç¿»è­¯çš„ä¸­æ–‡..." class="w-full bg-white border border-gray-200 rounded-lg p-3 text-sm focus:outline-none focus:ring-2 focus:ring-pink-300 min-h-[80px] resize-none"></textarea>
                        </div>
                        <button id="transBtn" onclick="handleRealTimeTranslate()" class="w-full bg-gradient-to-r from-pink-500 to-rose-400 text-white font-bold py-2.5 rounded-lg hover:opacity-90 transition flex items-center justify-center gap-2 shadow-sm active:scale-[0.98]">
                            <span id="transBtnText">ç¿»è­¯</span> <i id="transBtnIcon" class="fa-solid fa-arrow-right"></i>
                        </button>
                        <div id="transResults" class="hidden space-y-3 pt-3 border-t border-gray-200/50">
                            <div class="bg-white p-3 rounded-lg border border-gray-100 shadow-sm">
                                <div class="text-xs text-gray-400 mb-1">English</div>
                                <div id="resEn" class="text-sm text-gray-800 font-medium"></div>
                            </div>
                            <div class="bg-white p-3 rounded-lg border border-pink-100 shadow-sm">
                                <div class="text-xs text-pink-400 mb-1 flex items-center justify-between">
                                    <span>í•œêµ­ì–´ (Korean)</span>
                                    <button onclick="speakResult()" class="text-pink-500 hover:bg-pink-50 p-1.5 rounded transition"><i class="fa-solid fa-volume-high"></i></button>
                                </div>
                                <div id="resKo" class="text-sm text-pink-600 font-bold"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-100 mb-6 relative">
                    <i class="fa-solid fa-magnifying-glass absolute left-7 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                    <input id="phraseSearch" oninput="renderPhrases()" type="text" placeholder="æœå°‹å¸¸ç”¨å°è©±..." class="w-full pl-10 bg-gray-50 border border-gray-200 rounded-lg p-2.5 text-sm focus:outline-none focus:border-pink-500 transition">
                </div>
                <div id="phraseContainer" class="space-y-6 pb-20"></div>
            </div>

            <!-- VIEW 4: Info (è³‡è¨Š) -->
            <div id="view-info" class="view-section hidden fade-in bg-gray-50 min-h-full p-4">
                <div class="text-center mb-6 pt-4">
                    <h2 class="text-2xl font-bold text-pink-500 mb-2">å¯¦ç”¨è³‡è¨Š</h2>
                    <p class="text-sm text-gray-500">å¤©æ°£ã€ç·Šæ€¥è¯çµ¡ã€æ—…éŠé ˆçŸ¥</p>
                </div>
                
                <div class="bg-white p-4 shadow-sm rounded-xl border-2 border-red-100 mb-4">
                    <h3 class="font-bold text-gray-800 mb-4 text-lg flex items-center gap-2">
                        <i class="fa-solid fa-triangle-exclamation text-red-500"></i> ç·Šæ€¥è¯çµ¡é›»è©± ğŸš¨
                    </h3>
                    <div class="grid grid-cols-1 gap-3" id="emergencyList"></div>
                </div>

                <div class="bg-white p-4 shadow-sm rounded-xl border-2 border-blue-100 mb-4">
                    <h3 class="font-bold text-gray-800 mb-4 text-lg flex items-center gap-2">
                        <i class="fa-solid fa-cloud text-blue-500"></i> å¤©æ°£é å ± â˜ï¸
                    </h3>
                    <div class="space-y-3" id="weatherList"></div>
                    <div class="mt-4 p-3 bg-blue-50 rounded-lg border border-blue-100">
                        <p class="text-sm text-blue-800">
                            <strong>ç©¿è‘—å»ºè­°ï¼š</strong>é¦–çˆ¾2æœˆå¹³å‡æ°£æº« -3Â°C ~ 6Â°Cï¼Œè¨˜å¾—å¸¶åšå¤–å¥—ã€åœå·¾å’Œæ‰‹å¥—ï¼
                        </p>
                    </div>
                </div>

                <div id="tipsList" class="space-y-4 mb-4"></div>

                <div class="p-4 bg-gradient-to-br from-pink-50 to-purple-50 border border-pink-100 rounded-xl mb-4">
                    <h3 class="font-bold text-gray-800 mb-3 text-lg">å¿…å‚™App ğŸ“±</h3>
                    <div class="grid grid-cols-2 gap-3" id="appList"></div>
                </div>

                <div class="bg-white p-4 shadow-sm rounded-xl border-2 border-pink-100 mb-20">
                    <h3 class="font-bold text-gray-800 mb-4 text-lg flex items-center gap-2">
                        <i class="fa-solid fa-map-pin text-pink-500"></i> ä»å·æ©Ÿå ´ Smart Pass å‡ºå¢ƒæ•™å­¸ âœˆï¸
                    </h3>
                    <div class="space-y-4">
                        <div class="bg-pink-50 p-3 rounded-lg">
                            <h4 class="font-bold text-gray-800 mb-2">ğŸ’¡ ä»€éº¼æ˜¯ Smart Passï¼Ÿ</h4>
                            <p class="text-sm text-gray-600 leading-relaxed">
                                é€éäº‹å…ˆç™»è¨˜è­·ç…§ã€è‡‰éƒ¨æ•¸æ“šã€æ©Ÿç¥¨ç­‰è³‡è¨Šï¼Œè®“ä½ åœ¨ä»å·æ©Ÿå ´å‡ºå¢ƒæ™‚ï¼Œåªè¦é€éäººè‡‰è¾¨è­˜å°±å¯ä»¥å…å»å¤§æ’é•·é¾ï¼Œå¿«é€Ÿé€šé—œï¼
                            </p>
                        </div>
                        <div>
                            <h4 class="font-bold text-gray-800 mb-3">ğŸ“± ç™»éŒ„æ­¥é©Ÿ</h4>
                            <ol class="space-y-2" id="smartPassSteps"></ol>
                        </div>
                        <div id="smartPassFaq">
                            <h4 class="font-bold text-gray-800 mb-3">â“ å¸¸è¦‹å•é¡Œ</h4>
                            <div class="space-y-2" id="faqList"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- VIEW 5: Accounting (è¨˜å¸³) -->
            <div id="view-expense" class="view-section hidden fade-in bg-gray-50 min-h-full p-4">
                <div class="text-center mb-6 pt-4">
                    <h2 class="text-2xl font-bold text-pink-500 mb-2">æ—…éŠè¨˜å¸³</h2>
                    <p class="text-sm text-gray-500">åŒ¯ç‡æ›ç®— & æ¶ˆè²»è¨˜éŒ„</p>
                </div>
                <div class="bg-white p-4 shadow-sm rounded-xl border-2 border-pink-100 mb-4">
                    <h3 class="font-bold text-gray-800 mb-3 flex items-center gap-2">
                        <i class="fa-solid fa-calculator text-pink-500"></i> åŒ¯ç‡è¨­å®š
                    </h3>
                    <div class="flex items-center gap-3 bg-gray-50 p-2 rounded-lg">
                        <span class="text-sm text-gray-500 whitespace-nowrap">1 KRW =</span>
                        <input type="number" id="exchangeRateInput" step="0.0001" onchange="saveExchangeRate(this.value)" class="flex-1 bg-transparent border-none outline-none font-bold text-gray-800 text-center border-b border-gray-300 focus:border-pink-500" value="0.024">
                        <span class="text-sm text-gray-500">TWD</span>
                    </div>
                </div>
                <div class="bg-gradient-to-br from-blue-50 to-indigo-50 p-4 shadow-sm rounded-xl border-2 border-indigo-100 mb-4">
                    <h3 class="font-bold text-indigo-900 mb-3">å¿«é€Ÿè¨ˆç®—æ©Ÿ ğŸ§®</h3>
                    <div class="space-y-3">
                        <input type="text" id="calcInput" placeholder="è¼¸å…¥ç®—å¼ï¼Œä¾‹å¦‚ï¼š5000+3000*2" class="w-full bg-white border border-indigo-200 rounded-lg p-3 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-300">
                        <button onclick="calculate()" class="w-full bg-indigo-500 text-white font-bold py-2 rounded-lg hover:bg-indigo-600 transition shadow-sm">è¨ˆç®— =</button>
                        <div id="calcResultContainer" class="hidden bg-white rounded-lg p-3 text-center border border-indigo-100 shadow-sm">
                            <div class="text-2xl font-bold text-indigo-600" id="calcResultKrw"></div>
                            <div class="text-sm text-gray-500 mt-1" id="calcResultTwd"></div>
                        </div>
                    </div>
                </div>
                <div class="bg-gradient-to-r from-pink-500 to-rose-400 text-white p-5 rounded-xl shadow-lg mb-6 border border-pink-600">
                    <h3 class="font-bold mb-3 text-lg flex items-center gap-2"><i class="fa-solid fa-sack-dollar"></i> æ—…éŠç¸½èŠ±è²»</h3>
                    <div class="grid grid-cols-2 gap-4 divide-x divide-pink-400/50">
                        <div><div class="text-xs text-pink-100 opacity-90 mb-1">éŸ“å¹£ç¸½é¡</div><div class="text-xl font-bold" id="totalKrwDisplay">â‚©0</div></div>
                        <div class="pl-4"><div class="text-xs text-pink-100 opacity-90 mb-1">ç´„å°å¹£ç¸½é¡</div><div class="text-xl font-bold" id="totalTwdDisplay">NT$ 0</div></div>
                    </div>
                </div>
                <div class="bg-white p-4 shadow-sm rounded-xl border-2 border-gray-100 mb-6 relative">
                    <h3 class="font-bold text-gray-800 mb-3">è¨˜ä¸€ç­†å¸³ âœï¸</h3>
                    <div class="space-y-3">
                        <input type="text" id="exName" placeholder="å“é …åç¨±ï¼ˆä¾‹å¦‚ï¼šåˆé¤ã€å’–å•¡ï¼‰" class="w-full bg-gray-50 border border-gray-200 rounded-lg p-3 focus:outline-none focus:border-pink-500 transition">
                        <input type="number" id="exAmount" placeholder="éŸ“å¹£é‡‘é¡" class="w-full bg-gray-50 border border-gray-200 rounded-lg p-3 focus:outline-none focus:border-pink-500 transition">
                        <div class="flex gap-2">
                             <input type="file" id="photoInput" accept="image/*" class="hidden" onchange="handlePhotoSelect(this)">
                             <button onclick="document.getElementById('photoInput').click()" class="px-4 py-3 bg-gray-100 text-gray-600 rounded-lg hover:bg-gray-200 border border-gray-200 transition"><i class="fa-solid fa-camera"></i></button>
                             <button onclick="handleAddExpense()" class="flex-1 bg-pink-500 text-white font-bold py-3 rounded-lg hover:bg-pink-600 shadow-md active:scale-[0.98] transition">æ–°å¢</button>
                        </div>
                        <div id="imagePreviewContainer" class="hidden mt-2 relative inline-block">
                            <img id="imagePreview" src="" class="h-20 w-20 object-cover rounded-lg border border-gray-200">
                            <button onclick="clearPhoto()" class="absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs shadow-sm"><i class="fa-solid fa-times"></i></button>
                        </div>
                    </div>
                </div>
                <div class="space-y-3 pb-24">
                    <div class="flex justify-between items-center px-1">
                        <h3 class="font-bold text-gray-800">æ¶ˆè²»è¨˜éŒ„ ğŸ“</h3>
                        <button onclick="clearExpenses()" class="text-xs text-red-400 hover:text-red-600">æ¸…é™¤å…¨éƒ¨</button>
                    </div>
                    <div id="expenseList" class="space-y-3"></div>
                    <div id="emptyExpenseState" class="text-center py-10 text-gray-400 hidden bg-white rounded-xl border border-gray-100 border-dashed"><i class="fa-solid fa-receipt text-4xl mb-2 opacity-50"></i><p class="text-sm">é‚„æ²’æœ‰è¨˜å¸³ç´€éŒ„ï¼Œé–‹å§‹è¨˜éŒ„ä½ çš„æ—…éŠèŠ±è²»å§ï¼</p></div>
                </div>
            </div>

        </div>

        <!-- Bottom Navigation -->
        <nav class="fixed bottom-0 left-0 right-0 z-50 bg-white border-t border-gray-200 max-w-[480px] mx-auto safe-area-bottom">
            <div class="flex justify-around items-center h-[60px]">
                <button onclick="switchView('itinerary')" id="nav-itinerary" class="nav-item flex flex-col items-center justify-center w-full h-full text-xs font-medium nav-item-active">
                    <i class="fa-solid fa-map-location-dot text-xl mb-1"></i>
                    è¡Œç¨‹
                </button>
                <button onclick="switchView('guide')" id="nav-guide" class="nav-item flex flex-col items-center justify-center w-full h-full text-xs font-medium nav-item-inactive">
                    <i class="fa-solid fa-map-signs text-xl mb-1"></i>
                    å°è¦½
                </button>
                <button onclick="switchView('translation')" id="nav-translation" class="nav-item flex flex-col items-center justify-center w-full h-full text-xs font-medium nav-item-inactive">
                    <i class="fa-solid fa-language text-xl mb-1"></i>
                    ç¿»è­¯
                </button>
                <button onclick="switchView('info')" id="nav-info" class="nav-item flex flex-col items-center justify-center w-full h-full text-xs font-medium nav-item-inactive">
                    <i class="fa-solid fa-circle-info text-xl mb-1"></i>
                    è³‡è¨Š
                </button>
                <button onclick="switchView('expense')" id="nav-expense" class="nav-item flex flex-col items-center justify-center w-full h-full text-xs font-medium nav-item-inactive">
                    <i class="fa-solid fa-wallet text-xl mb-1"></i>
                    è¨˜å¸³
                </button>
            </div>
        </nav>

        <div id="toast"></div>

    </div>

    <!-- Modals -->
    <div id="infoModal" class="fixed inset-0 z-[60] hidden flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-black/50 backdrop-blur-sm" onclick="toggleInfoModal()"></div>
        <div class="relative bg-white rounded-2xl p-6 w-full max-w-sm mx-auto shadow-2xl">
            <h3 class="text-xl font-bold mb-2">é—œæ–¼æ­¤ App</h3>
            <p class="text-gray-600 text-sm mb-4">é¦–çˆ¾è‡ªç”±è¡Œå¤šåŠŸèƒ½åŠ©æ‰‹ v5.0</p>
            <ul class="text-xs text-gray-500 list-disc pl-4 space-y-1 mb-4">
                <li>Day 7 åŒ…è»Šè²»ç”¨è³‡è¨Šå·²æ›´æ–°ã€‚</li>
                <li>å…¨åŠŸèƒ½æ•´åˆã€‚</li>
            </ul>
            <button onclick="toggleInfoModal()" class="w-full bg-gray-800 text-white py-2 rounded-lg font-bold">é—œé–‰</button>
        </div>
    </div>

    <script>
        // --- 1. Global View Management ---
        function switchView(viewName) {
            document.querySelectorAll('.view-section').forEach(el => el.classList.add('hidden'));
            document.getElementById(`view-${viewName}`).classList.remove('hidden');
            
            document.querySelectorAll('.nav-item').forEach(el => {
                el.classList.remove('nav-item-active', 'text-pink-500');
                el.classList.add('nav-item-inactive');
            });
            const activeNav = document.getElementById(`nav-${viewName}`);
            activeNav.classList.remove('nav-item-inactive');
            activeNav.classList.add('nav-item-active', 'text-pink-500');
        }

        // --- 2. Itinerary Logic ---
        const itineraryData = [
            { 
                day: 1, title: "å¼˜å¤§æ•£ç­–", date: "1/31 (å…­)", dateShort: "01.31 (å…­)", dayNum: "31", location: "éº»æµ¦ / å¼˜å¤§", temp: "-2Â°", weatherIcon: "fa-snowflake", 
                bg: "https://res.klook.com/image/upload/w_750,h_469,c_fill,q_85/w_80,x_15,y_15,g_south_west,l_Klook_water_br_trans_yhcmh3/activities/zvz04fztecclqqnjokjz.webp", 
                events: [ 
                    { 
                        time: "10:30", title: "æŠµé”ä»å·æ©Ÿå ´", desc: "é ˜å– Wifiã€T-money å¡", icon: "fa-plane-arrival", color: "bg-blue-500",
                        thumb: "https://cf.creatrip.com/original/blog/2847/g6bsowcthdouk70n0ad7mhxp059dz15s.jpg?d=750&q=75&f=webp",
                        searchUrl: "https://creatrip.com/blog/2847"
                    },
                    { 
                        time: "13:00", title: "Check-in RYSEé£¯åº—", desc: "é¦–çˆ¾éº»æµ¦å€è¥¿æ©‹æ´", icon: "fa-hotel", color: "bg-indigo-500",
                        thumb: "https://i.travelapi.com/lodging/90000000/89310000/89303600/89303597/ea931230_z.jpg?impolicy=resizecrop&rw=1200&ra=fit",
                        searchUrl: "https://www.klook.com/zh-TW/hotels/detail/426496-ryse-autograph-collection-seoul-by-marriott/" 
                    },
                    { 
                        time: "15:00", title: "å¼˜å¤§å•†åœˆ", desc: "é£¯åº—é™„è¿‘é€›é€›", icon: "fa-bag-shopping", color: "bg-pink-500",
                        thumb: "https://res.klook.com/image/upload/fl_lossy.progressive,q_85/c_fill,w_1000/v1733909263/kv7f2asxlngpiwlzjqbm.webp",
                        searchUrl: "https://www.klook.com/zh-TW/blog/hongdae/"
                    },
                    { 
                        time: "17:00", title: "äº‚æ‰“ç§€", desc: "é£¯åº—èµ°è·¯3åˆ†é˜ â€»è¡Œå‰å…ˆé ç´„1/31 17:00å ´æ¬¡", icon: "fa-masks-theater", color: "bg-purple-600", tag: "éœ€é ç´„",
                        thumb: "https://res.klook.com/image/upload/w_750,h_469,c_fill,q_85/w_80,x_15,y_15,g_south_west,l_Klook_water_br_trans_yhcmh3/activities/p9ri8entvc8myzwh8xi9.webp", // Nanta Updated
                        searchUrl: "https://www.klook.com/zh-TW/activity/240-nanta-show-seoul/"
                    },
                    { 
                        time: "19:00", title: "æ™šé¤ï¼šéµæ¿é›", desc: "ç”³ç¾äº¬å¼˜å¤§éµæ¿é›", icon: "fa-utensils", color: "bg-orange-500",
                        thumb: "https://cf.creatrip.com/original/blog/12342/orhl5rqn9x4qabbmkma2gldhy56wyeh4.jpg?d=750&q=75&f=webp",
                        searchUrl: "https://creatrip.com/zh-TW/blog/12342"
                    },
                    { 
                        time: "22:00", title: "ä½å®¿ï¼šRYSE", desc: "RYSE, Autograph Collection", icon: "fa-bed", color: "bg-indigo-400",
                        thumb: "https://i.travelapi.com/lodging/90000000/89310000/89303600/89303597/ea931230_z.jpg?impolicy=resizecrop&rw=1200&ra=fit",
                        searchUrl: "https://www.klook.com/zh-TW/hotels/detail/426496-ryse-autograph-collection-seoul-by-marriott/"
                    }
                ]
            },
            { 
                day: 2, title: "å‚³çµ±æ–‡åŒ–èˆ‡é¦–çˆ¾å¡”", date: "2/1 (æ—¥)", dateShort: "02.01 (æ—¥)", dayNum: "01", location: "é˜è·¯ / å—å±±", temp: "0Â°", weatherIcon: "fa-cloud-sun", 
                bg: "https://res.klook.com/image/upload/u_activities:xui9hudopofmrcgtfasl,h_1.0,ar_16:9,c_scale,e_blur:10000/w_1265,h_791,c_fill,q_85/w_80,x_15,y_15,g_south_west,l_Klook_water_br_trans_yhcmh3/activities/xui9hudopofmrcgtfasl.webp", 
                events: [ 
                    { 
                        time: "10:30", title: "éŸ“æœé«”é©—", desc: "è¥¿èŠ±éŸ“æœ â€»è¡Œå‰å…ˆé ç´„10:30", icon: "fa-shirt", color: "bg-pink-400", tag: "éœ€é ç´„",
                        thumb: "https://res.klook.com/image/upload/w_1265,h_791,c_fill,q_85/w_80,x_15,y_15,g_south_west,l_Klook_water_br_trans_yhcmh3/activities/e9zmmlbqakylng8lingv.webp", // Seohwa
                        searchUrl: "https://www.klook.com/zh-TW/activity/24844-seohwa-hanbok-rental-gyeongbokgung-seoul/?spm=SearchResult.SearchResult_LIST&clickId=7b5dfbc8d5" 
                    },
                    { 
                        time: "11:30", title: "å¤å®®å·¡ç¦®", desc: "æ™¯ç¦å®®ã€åŒ—æ‘éŸ“å±‹æ‘ã€ä¸‰æ¸…æ´", icon: "fa-landmark", color: "bg-yellow-600",
                        thumb: "https://res.klook.com/image/upload/c_crop,h_1007,w_1611,x_0,y_19,z_0.4/w_1265,h_791,c_fill,q_85/w_80,x_15,y_15,g_south_west,l_Klook_water_br_trans_yhcmh3/activities/ta5jejbbj8rkrmxsrdos.webp", 
                        searchUrl: "https://www.klook.com/zh-TW/activity/153150-gyeongbokgung-bukchon-gwangjang-market-walking-day-tour/"
                    },
                    { 
                        time: "13:30", title: "åˆé¤ï¼šè”˜é›æ¹¯", desc: "åœŸä¿—æ‘è”˜é›æ¹¯", icon: "fa-bowl-food", color: "bg-orange-500",
                        thumb: "https://cf.creatrip.com/original/blog/4772/p44icgt1kc46fixn4nn7k85a01zra7yx.jpg?d=750&q=75&f=webp",
                        searchUrl: "https://creatrip.com/zh-TW/blog/4772"
                    },
                    { 
                        time: "16:00", title: "N é¦–çˆ¾å¡”", desc: "æ­ä¹˜çºœè»Šä¸Šå±±çœ‹é¢¨æ™¯", icon: "fa-tower-broadcast", color: "bg-blue-700",
                        thumb: "https://res.klook.com/image/upload/w_750,h_469,c_fill,q_85/w_80,x_15,y_15,g_south_west,l_Klook_water_br_trans_yhcmh3/activities/js230hdcw5zvquv5x6na.webp",
                        searchUrl: "https://www.klook.com/zh-TW/activity/412-n-seoul-tower-seoul/" 
                    },
                    { 
                        time: "22:00", title: "ä½å®¿ï¼šRYSE", desc: "RYSE, Autograph Collection", icon: "fa-bed", color: "bg-indigo-400",
                        thumb: "https://i.travelapi.com/lodging/90000000/89310000/89303600/89303597/ea931230_z.jpg?impolicy=resizecrop&rw=1200&ra=fit",
                        searchUrl: "https://www.klook.com/zh-TW/hotels/detail/426496-ryse-autograph-collection-seoul-by-marriott/"
                    }
                ]
            },
            { 
                day: 3, title: "æ»‘é›ªåº¦å‡æ‘ Day 1", date: "2/2 (ä¸€)", dateShort: "02.02 (ä¸€)", dayNum: "02", location: "æ±ŸåŸé“ / æ´ªå·", temp: "-5Â°", weatherIcon: "fa-snowflake", 
                bg: "https://res.klook.com/image/upload/w_750,h_469,c_fill,q_85/w_80,x_15,y_15,g_south_west,l_Klook_water_br_trans_yhcmh3/activities/ml2k9oiugmqhp5sl3bti.webp", 
                events: [ 
                    { 
                        time: "06:20", title: "é›†åˆå‡ºç™¼", desc: "å¼˜å¤§ç«™8è™Ÿå‡ºå£ç­‰å·´å£« (6:30ç™¼è»Š)", icon: "fa-bus", color: "bg-red-500", tag: "AsiaYoåœ˜",
                        thumb: "https://image-store.asiayo.com/bnb/45651/autoxauto/desc_U7eDNMshUjOcs3.webp",
                        searchUrl: "https://asiayo.com/zh-tw/activity/54107/"
                    },
                    { 
                        time: "10:00", title: "SKI åˆç´šæ»‘é›ª", desc: "æ»‘é›ªæ•™å­¸ 1å°æ™‚ã€æ»‘é›ªåŠè»Š", icon: "fa-person-skiing", color: "bg-cyan-500",
                        thumb: "https://res.klook.com/image/upload/w_750,h_469,c_fill,q_85/w_80,x_15,y_15,g_south_west,l_Klook_water_br_trans_yhcmh3/activities/ml2k9oiugmqhp5sl3bti.webp" // Ski
                    },
                    { 
                        time: "15:00", title: "é£¯åº—å…¥ä½", desc: "SONO é£¯åº—å…¥ä½ + ä½¿ç”¨è¨­æ–½", icon: "fa-hotel", color: "bg-indigo-500",
                        thumb: "https://i.travelapi.com/lodging/6000000/5710000/5702300/5702220/759949d5_z.jpg?impolicy=resizecrop&rw=1200&ra=fit",
                        searchUrl: "https://www.klook.com/zh-TW/hotels/detail/432091-vivaldipark/"
                    },
                    { 
                        time: "19:00", title: "æ±—è’¸å¹•", desc: "è‡ªè²»è¡Œç¨‹ï¼Œæ”¾é¬†èº«å¿ƒ", icon: "fa-hot-tub-person", color: "bg-orange-400",
                        thumb: "https://s.yimg.com/ny/api/res/1.2/6mycv_1twUBo0W_2gtI6jQ--/YXBwaWQ9aGlnaGxhbmRlcjt3PTk2MDtoPTcxMTtjZj13ZWJw/https://media-mbst-pub-ue1.s3.amazonaws.com/creatr-uploaded-images/2020-01/36cdc5c0-36e4-11ea-bbbf-58455b855bd9",
                        searchUrl: "https://tw.news.yahoo.com/%E9%9F%93%E5%9C%8B%E6%B4%AA%E5%B7%9D%E5%A4%A7%E6%98%8E%E7%B6%AD%E7%93%A6%E7%88%BE%E7%AC%AC%E5%85%AC%E5%9C%92%E6%B1%97%E8%92%B8%E5%B9%95%E6%8E%92%E6%AF%92%E7%BE%8E%E5%AE%B9%E5%85%BC%E7%99%82%E7%99%92-235917722.html"
                    },
                    { 
                        time: "22:00", title: "ä½å®¿ï¼šSONO", desc: "SONO Hotel Vivaldi Park", icon: "fa-bed", color: "bg-indigo-400",
                        thumb: "https://i.travelapi.com/lodging/6000000/5710000/5702300/5702220/759949d5_z.jpg?impolicy=resizecrop&rw=1200&ra=fit",
                        searchUrl: "https://www.klook.com/zh-TW/hotels/detail/432091-vivaldipark/"
                    }
                ]
            },
            { 
                day: 4, title: "æ»‘é›ªåº¦å‡æ‘ Day 2", date: "2/3 (äºŒ)", dateShort: "02.03 (äºŒ)", dayNum: "03", location: "æ´ªå· / æ˜æ´", temp: "-3Â°", weatherIcon: "fa-snowflake", 
                bg: "https://res.klook.com/image/upload/w_1265,h_791,c_fill,q_85/w_80,x_15,y_15,g_south_west,l_Klook_water_br_trans_yhcmh3/activities/tidatjrzmqmnfeyxk7mp.webp", 
                events: [ 
                    { time: "10:00", title: "è§€å…‰çºœè»Š", desc: "æ¬£è³é›ªæ™¯", icon: "fa-mountain", color: "bg-cyan-600",
                        thumb: "https://image-store.asiayo.com/bnb/45651/autoxauto/desc_lyCwbFCBIgMzx9.webp",
                        searchUrl: "https://asiayo.com/zh-tw/activity/45651/"
                    },
                    { 
                        time: "13:00", title: "Snowy Land", desc: "å†°é›ªæ¨‚åœ’éŠç©", icon: "fa-snowflake", color: "bg-blue-400",
                        thumb: "https://res.klook.com/image/upload/w_750,h_469,c_fill,q_85/w_80,x_15,y_15,g_south_west,l_Klook_water_br_trans_yhcmh3/activities/ml2k9oiugmqhp5sl3bti.webp" // Reuse Ski Resort image for Snowy Land
                    },
                    { time: "16:45", title: "å›ç¨‹å·´å£«", desc: "æº–å‚™è¿”å›é¦–çˆ¾", icon: "fa-bus", color: "bg-gray-600",
                        thumb: "https://asiayo.com/_next/image/?url=https%3A%2F%2Fimage-store.asiayo.com%2Fbnb%2F45651%2F960xauto%2Fdesc_XRhz4t9oMGoBxa.jpg&w=1080&q=75",
                        searchUrl: "https://asiayo.com/zh-tw/activity/45651/"
                    },
                    { time: "19:30", title: "æŠµé”æ˜æ´", desc: "ä¹™æ”¯è·¯å…¥å£ç«™ä¸‹è»Š", icon: "fa-map-pin", color: "bg-red-500",
                        thumb: "https://i2.wp.com/img.koreagaja.com/web_upload/dc31408b1af15a37cd7c61e10ca101e9.png",
                        searchUrl: "https://travel.line.me/article/5470"
                    },
                    { 
                        time: "20:00", title: "æ˜æ´å•†åœˆ", desc: "æ™šé¤èˆ‡é€›è¡—", icon: "fa-bag-shopping", color: "bg-pink-500",
                        thumb: "https://res.klook.com/image/upload/fl_lossy.progressive,q_85/c_fill,w_1000/v1728994482/cpi8vsl5elewldburrkn.webp", // Myeongdong Street
                        searchUrl: "https://www.klook.com/zh-TW/blog/myeong-dong/"
                    },
                    { 
                        time: "22:00", title: "ä½å®¿ï¼šMoxy", desc: "Moxy Seoul Myeongdong", icon: "fa-bed", color: "bg-indigo-400",
                        thumb: "https://i.travelapi.com/lodging/90000000/89310000/89303600/89303597/ea931230_z.jpg?impolicy=resizecrop&rw=1200&ra=fit",
                        searchUrl: "https://www.klook.com/zh-TW/hotels/detail/1130730-moxy-seoul-myeongdong/"
                    }
                ]
            },
            { 
                day: 5, title: "å—å¤§é–€èˆ‡æ±Ÿå—ä¸€æ—¥éŠ", date: "2/4 (ä¸‰)", dateShort: "02.04 (ä¸‰)", dayNum: "04", location: "æ˜æ´ / æ±Ÿå—", temp: "1Â°", weatherIcon: "fa-sun", 
                bg: "https://res.klook.com/image/upload/w_750,h_469,c_fill,q_85/w_80,x_15,y_15,g_south_west,l_Klook_water_br_trans_yhcmh3/activities/svpqsljlmysehtck8zbc.webp", // Starfield Library BG
                events: [ 
                    { 
                        time: "09:00", title: "æ›éŒ¢", desc: "æ˜æ´å¤§ä½¿é¤¨ æˆ– Money Planet", icon: "fa-money-bill-wave", color: "bg-green-500" 
                    },
                    { 
                        time: "09:30", title: "å—å¤§é–€å¸‚å ´", desc: "æ—©é¤ã€è²·å°ç‰© (è»Šç¨‹ç´„20åˆ†)", icon: "fa-store", color: "bg-orange-600",
                        thumb: "https://cf.creatrip.com/original/blog/4710/zqqcr9akv56b3prwttru3nvozspk7k9g.jpg?d=750&q=75&f=webp",
                        searchUrl: "https://creatrip.com/blog/4710"
                    },
                    { 
                        time: "11:00", title: "COEX æ˜Ÿç©ºåœ–æ›¸é¤¨", desc: "æ±Ÿå—ä¸€æ—¥éŠï¼šç¶²ç¾æ‰“å¡è–åœ°", icon: "fa-book-open", color: "bg-yellow-600",
                        thumb: "https://cf.creatrip.com/original/blog/4896/t6tldqnq22q0tfb4swb15q239f6a2fun.jpg?d=750&q=75&f=webp",
                        searchUrl: "https://creatrip.com/blog/4896"
                    },
                    { 
                        time: "12:00", title: "åˆé¤ï¼šCOEXåœ°ä¸‹è¡—", desc: "åœ¨ Mall å…§äº«ç”¨åˆé¤", icon: "fa-utensils", color: "bg-orange-500"
                    },
                    { 
                        time: "13:00", title: "COEX æ°´æ—é¤¨", desc: "å®¤å…§æ°´æ—é¤¨åƒè§€", icon: "fa-fish", color: "bg-blue-500",
                        thumb: "https://res.klook.com/image/upload/w_750,h_469,c_fill,q_85/w_80,x_15,y_15,g_south_west,l_Klook_water_br_trans_yhcmh3/activities/svpqsljlmysehtck8zbc.webp", // Aquarium
                        searchUrl: "https://www.klook.com/destination/p50108071-coex-aquarium/"
                    },
                    { 
                        time: "15:30", title: "ç‹é·—äº­ & æ¸…æ½­æ´", desc: "æ­è»Šå‰å¾€ï¼šå’–å•¡/è¡—å€/K-popå‘¨é‚Š", icon: "fa-coffee", color: "bg-purple-500",
                        thumb: "https://img.bigfang.tw/2024/10/1728031461-e4bde0eb46b8f32ef4b4207f5344b4d4.jpg",
                        searchUrl: "https://www.bigfang.tw/blog/post/apgujeong-heongdam-walking"
                    },
                    { 
                        time: "17:30", title: "æ™šé¤", desc: "æ±Ÿå—/ç‹é·—äº­å‘¨é‚Šç¾é£Ÿæ¨è–¦", icon: "fa-utensils", color: "bg-orange-500" 
                    },
                    { 
                        time: "18:30", title: "æ¨‚å¤©è¶…å¸‚ (é¦–çˆ¾ç«™)", desc: "å‰å¾€æ¡è²· (åœç•™ç´„1å°æ™‚)", icon: "fa-cart-shopping", color: "bg-green-600",
                        thumb: "https://cf.creatrip.com/original/blog/2/nv7spodt3sfz4gqk5560usp7ure8kog0.jpg?d=750&q=75&f=webp",
                        searchUrl: "https://creatrip.com/zh-TW/blog/2"
                    },
                    { 
                        time: "22:00", title: "ä½å®¿ï¼šMoxy", desc: "Moxy Seoul Myeongdong", icon: "fa-bed", color: "bg-indigo-400",
                        thumb: "https://i.travelapi.com/lodging/90000000/89310000/89303600/89303597/ea931230_z.jpg?impolicy=resizecrop&rw=1200&ra=fit",
                        searchUrl: "https://www.klook.com/zh-TW/hotels/detail/1130730-moxy-seoul-myeongdong/"
                    }
                ]
            },
            { 
                day: 6, title: "æ¨‚å¤©ä¸–ç•Œä¸€æ—¥éŠ", date: "2/5 (å››)", dateShort: "02.05 (å››)", dayNum: "05", location: "æ¾å¡ / é¦–çˆ¾ç«™", temp: "2Â°", weatherIcon: "fa-cloud", 
                bg: "https://res.klook.com/image/upload/c_crop,h_1875,w_3000,x_0,y_49,z_0.3/w_1265,h_791,c_fill,q_85/w_80,x_15,y_15,g_south_west,l_Klook_water_br_trans_yhcmh3/activities/tlsbholhbdch17rrl0dm.webp", // Lotte World BG
                events: [ 
                    { 
                        time: "10:00", title: "æ¨‚å¤©ä¸–ç•Œ", desc: "æ¨‚å¤©ä¸–ç•Œå®¤å…§å¤–æ¨‚åœ’ä¸€æ—¥éŠ", icon: "fa-ticket", color: "bg-red-500",
                        thumb: "https://res.klook.com/image/upload/c_crop,h_1875,w_3000,x_0,y_49,z_0.3/w_1265,h_791,c_fill,q_85/w_80,x_15,y_15,g_south_west,l_Klook_water_br_trans_yhcmh3/activities/tlsbholhbdch17rrl0dm.webp", // Lotte World
                        searchUrl: "https://www.klook.com/activity/136541-ultra-lotte-experience-tour/"
                    },
                    { 
                        time: "18:00", title: "Seoul Sky", desc: "æ¨‚å¤©ä¸–ç•Œå¡”è§€æ™¯å° (è¦–æƒ…æ³)", icon: "fa-building", color: "bg-blue-800",
                        thumb: "https://cf.creatrip.com/original/blog/1422/ai5e7pqfsijjofg86aek7vrvkb6nn4al.jpg?d=750&q=75&f=webp",
                        searchUrl: "https://creatrip.com/blog/1422"
                    },
                    { 
                        time: "20:00", title: "æ¨‚å¤©è¶…å¸‚ (é¦–çˆ¾ç«™)", desc: "æœ€å¾Œè£œè²¨æ¡è²·", icon: "fa-cart-shopping", color: "bg-green-600",
                        thumb: "https://cf.creatrip.com/original/blog/2/nv7spodt3sfz4gqk5560usp7ure8kog0.jpg?d=750&q=75&f=webp",
                        searchUrl: "https://creatrip.com/zh-TW/blog/2"
                    },
                    { 
                        time: "22:00", title: "ä½å®¿ï¼šMoxy", desc: "Moxy Seoul Myeongdong", icon: "fa-bed", color: "bg-indigo-400",
                        thumb: "https://i.travelapi.com/lodging/90000000/89310000/89303600/89303597/ea931230_z.jpg?impolicy=resizecrop&rw=1200&ra=fit",
                        searchUrl: "https://www.klook.com/zh-TW/hotels/detail/1130730-moxy-seoul-myeongdong/"
                    }
                ]
            },
            { 
                day: 7, title: "è¿”ç¨‹", date: "2/6 (äº”)", dateShort: "02.06 (äº”)", dayNum: "06", location: "ä»å·æ©Ÿå ´", temp: "3Â°", weatherIcon: "fa-sun", 
                bg: "https://res.klook.com/image/upload/w_1265,h_791,c_fill,q_85/w_80,x_15,y_15,g_south_west,l_Klook_water_br_trans_yhcmh3/activities/eixbh8jkobcqoh17yw4d.webp", 
                events: [ 
                    { 
                        time: "07:00", title: "åŒ…è»Šå‰å¾€æ©Ÿå ´", 
                        desc: "Moxy é£¯åº—é–€å£é›†åˆ<br>èˆªç­ï¼šBR169<br>å…±8ä½ / 8è¡Œæ / 2å°è»Š<br>è²»ç”¨ï¼šä¸€å°è»Š 90000 éŸ“å¹£ (ç¾é‡‘)<br><span class='text-xs text-gray-500'>åœ°å€ï¼šMoxy Seoul Myeongdong ä¸­å€æ˜æ´ 8na è¡— 38 è™Ÿ</span>", 
                        icon: "fa-taxi", color: "bg-yellow-500",
                        thumb: "https://res.klook.com/image/upload/w_1265,h_791,c_fill,q_85/w_80,x_15,y_15,g_south_west,l_Klook_water_br_trans_yhcmh3/activities/eixbh8jkobcqoh17yw4d.webp" // Airport Transfer
                    },
                    { time: "08:20", title: "æŠµé”ä»å·æ©Ÿå ´", desc: "è¾¦ç†ç™»æ©Ÿ (BR169) èˆ‡é€€ç¨…", icon: "fa-plane-departure", color: "bg-blue-500" }
                ]
            }
        ];

        let currentDay = 1;

        function updateBannerClock() {
            const clockEl = document.getElementById('bannerClock');
            if (clockEl) {
                const now = new Date();
                const hours = String(now.getHours()).padStart(2, '0');
                const minutes = String(now.getMinutes()).padStart(2, '0');
                clockEl.innerText = `${hours}:${minutes}`;
            }
        }
        setInterval(updateBannerClock, 1000);

        function renderTabs() {
            const tabsContainer = document.getElementById('dayTabs');
            tabsContainer.innerHTML = '';
            itineraryData.forEach(item => {
                const btn = document.createElement('button');
                const isActive = item.day === currentDay;
                btn.className = `flex-none tab-btn w-[70px] h-[70px] rounded-xl flex flex-col items-center justify-center transition-all ${isActive ? 'tab-active' : 'tab-inactive'}`;
                btn.innerHTML = `
                    <div class="text-[10px] font-bold tracking-wider uppercase opacity-70">DAY ${item.day}</div>
                    <div class="text-2xl font-bold font-mono leading-none mt-1">${item.dayNum}</div>
                `;
                btn.onclick = () => { currentDay = item.day; renderTabs(); renderItinerary(); };
                tabsContainer.appendChild(btn);
            });
        }

        function renderItinerary() {
            const contentContainer = document.getElementById('itineraryContent');
            const bannerContainer = document.getElementById('itineraryBanner');
            const data = itineraryData.find(d => d.day === currentDay);
            contentContainer.innerHTML = '';
            if (!data) return;

            bannerContainer.innerHTML = `
                <div class="relative w-full h-[340px] overflow-hidden bg-gray-900 transition-all duration-500">
                    <img src="${data.bg}" class="absolute w-full h-full object-cover opacity-80 animate-fade-in-up" alt="Banner">
                    <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-black/20 to-black/30"></div>
                    <div class="absolute inset-0 p-6 flex flex-col justify-between">
                        <div class="flex justify-between items-start pt-2">
                            <div class="text-white/60 text-xs font-medium tracking-[0.2em] uppercase pt-1">SEOUL TRIP</div>
                            <div class="text-white font-medium text-lg tracking-wider text-shadow">${data.dateShort}</div>
                            <div class="glass-card rounded-2xl p-2.5 text-center text-white min-w-[64px]">
                                <div class="text-xl mb-0.5"><i class="fa-solid ${data.weatherIcon} ${data.weatherIcon === 'fa-sun' ? 'text-yellow-300' : 'text-white'}"></i></div>
                                <div class="text-sm font-bold">${data.temp}</div>
                            </div>
                        </div>
                        <div class="mt-auto pb-4">
                            <div class="text-6xl font-bold text-white mb-2 tracking-tighter text-shadow" id="bannerClock">00:00</div>
                            <div class="flex flex-wrap items-end gap-x-4 gap-y-1">
                                <h2 class="text-2xl font-bold text-white leading-tight text-shadow">${data.title}</h2>
                                <div class="text-white/90 text-sm flex items-center gap-1.5 font-medium bg-black/20 px-2 py-1 rounded-full backdrop-blur-sm border border-white/10">
                                    <i class="fa-solid fa-location-dot text-pink-500"></i>
                                    <span>${data.location}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            updateBannerClock();

            const timelineWrapper = document.createElement('div');
            timelineWrapper.className = "relative pb-4 mt-2";
            const line = document.createElement('div');
            line.className = "timeline-line";
            timelineWrapper.appendChild(line);

            data.events.forEach((event, index) => {
                const eventEl = document.createElement('div');
                eventEl.className = "relative pl-12 mb-8 fade-in";
                eventEl.style.animationDelay = `${index * 0.1}s`;
                
                const tagHtml = event.tag ? `<span class="ml-2 inline-block px-2 py-0.5 bg-red-50 text-red-500 text-xs rounded-full font-bold border border-red-100">${event.tag}</span>` : '';
                
                // Dynamic Links
                const query = encodeURIComponent(event.title + " é¦–çˆ¾");
                // Use custom searchUrl if provided, otherwise use Google search
                const searchUrl = event.searchUrl || `https://www.google.com/search?q=${query}`;
                const mapUrl = `https://www.google.com/maps/search/?api=1&query=${query}`;
                const mapIcon = event.mapIcon || 'fa-map-location-dot';

                eventEl.innerHTML = `
                    <div class="absolute left-0 top-0 w-10 h-10 ${event.color} rounded-full flex items-center justify-center text-white shadow-lg z-10 border-4 border-white"><i class="fa-solid ${event.icon} text-sm"></i></div>
                    <div class="bg-white rounded-xl p-4 shadow-sm border border-gray-100 active:scale-[0.99] transition-transform">
                        <div class="flex gap-4">
                            <div class="flex-1">
                                <!-- Top Row: Time + Buttons -->
                                <div class="flex justify-between items-center mb-2">
                                    <span class="inline-block px-2 py-0.5 bg-gray-100 text-gray-600 text-xs rounded-md font-bold font-mono">${event.time}</span>
                                    <div class="flex items-center gap-2">
                                        <a href="${searchUrl}" target="_blank" class="text-[10px] px-2 py-0.5 rounded border border-pink-200 text-pink-500 bg-pink-50 flex items-center gap-1 hover:bg-pink-100 transition shadow-sm">
                                            <i class="fa-solid fa-book-open"></i> ä»‹ç´¹
                                        </a>
                                        <a href="${mapUrl}" target="_blank" class="text-gray-400 hover:text-gray-600 transition p-1">
                                            <i class="fa-solid ${mapIcon} text-lg"></i>
                                        </a>
                                    </div>
                                </div>
                                
                                <!-- Middle: Title -->
                                <h3 class="text-lg font-bold text-gray-800 mb-1 flex flex-wrap items-center">
                                    ${event.title} ${tagHtml}
                                </h3>
                                
                                <!-- Bottom: Desc -->
                                <p class="text-gray-600 text-sm leading-relaxed">${event.desc}</p>
                            </div>
                            
                            <!-- Thumbnail -->
                            ${event.thumb ? `<a href="${searchUrl}" target="_blank" class="flex-shrink-0"><img src="${event.thumb}" class="w-20 h-20 rounded-lg object-cover flex-shrink-0 border border-gray-100 self-center"></a>` : ''}
                        </div>
                    </div>`;
                timelineWrapper.appendChild(eventEl);
            });
            contentContainer.appendChild(timelineWrapper);
        }

        // --- 3. Guide Logic (Updated with Google Maps Embed) ---
        const guideData = [
            { title: "æ™¯ç¦å®®", krName: "ê²½ë³µê¶", tag: "æ­·å²æ–‡åŒ–", desc: "æœé®®ç‹æœäº”å¤§å®®æ®¿ä¹‹é¦–ï¼Œå»ºæ–¼1395å¹´ï¼Œæ˜¯é¦–çˆ¾æœ€å…·ä»£è¡¨æ€§çš„å¤è¹Ÿã€‚", hours: "09:00 - 17:00 (é€±äºŒå…¬ä¼‘)", price: "â‚©3,000 (ç©¿éŸ“æœå…è²»)", bestTime: "æ˜¥ç§‹å­£ç¯€ã€å®ˆé–€å°‡äº¤æ¥æ™‚é–“", tips: ["å»ºè­°ç§ŸéŸ“æœæ‹ç…§ï¼ˆç©¿éŸ“æœå…é–€ç¥¨ï¼‰", "æœ€ä½³æ‹ç…§æ™‚é–“ï¼šä¸Šåˆ9-11é»å…‰ç·šæœ€å¥½"], query: "Gyeongbokgung Palace" },
            { title: "åŒ—æ‘éŸ“å±‹æ‘", krName: "ë¶ì´Œí•œì˜¥ë§ˆì„", tag: "æ­·å²æ–‡åŒ–", desc: "ä¿ç•™äº†æœé®®æ™‚ä»£çš„å‚³çµ±å»ºç¯‰é¢¨æ ¼ã€‚", hours: "10:00 - 17:00 (é€±æ—¥ä¼‘æ¯)", price: "å…è²»åƒè§€", bestTime: "ä¸Šåˆæ™‚æ®µè¼ƒç‚ºå®‰éœ", tips: ["æ­¤è™•ç‚ºä½å®…å€ï¼Œè«‹ä¿æŒå®‰éœ", "å¡åº¦è¼ƒé™¡ï¼Œå»ºè­°ç©¿è‘—èˆ’é©å¥½èµ°çš„é‹"], query: "Bukchon Hanok Village" },
            { title: "å—å±±é¦–çˆ¾å¡”", krName: "Nì„œìš¸íƒ€ì›Œ", tag: "åœ°æ¨™æ™¯é»", desc: "é¦–çˆ¾çš„åœ°æ¨™æ€§å»ºç¯‰ï¼Œä¿¯ç°é¦–çˆ¾å…¨æ™¯ã€‚", hours: "10:00 - 23:00", price: "å±•æœ›å°ç´„ â‚©21,000", bestTime: "é»ƒæ˜è‡³å¤œé–“", tips: ["å»ºè­°æ­ä¹˜å—å±±çºœè»Š", "æ„›æƒ…é–ç‰†æ˜¯æƒ…ä¾¶å¿…å»æ‰“å¡é»"], query: "N Seoul Tower" },
            { title: "å¼˜å¤§å•†åœˆ", krName: "í™ëŒ€ê±°ë¦¬", tag: "è³¼ç‰©å¨›æ¨‚", desc: "é¦–çˆ¾æœ€å¹´è¼•ã€æœ€å…·æ´»åŠ›çš„å•†åœˆã€‚", hours: "åº—å®¶ç´„ 11:00 - 23:00", price: "å…è²»", bestTime: "ä¸‹åˆè‡³æ·±å¤œ", tips: ["è¡—é ­è¡¨æ¼”æ–‡åŒ–ç››è¡Œ", "é©åˆå°‹æ‰¾å¹³åƒ¹æ™‚å°š"], query: "Hongdae Shopping Street" },
            { title: "æ˜æ´å•†åœˆ", krName: "ëª…ë™", tag: "è³¼ç‰©ç¾é£Ÿ", desc: "é¦–çˆ¾ä»£è¡¨æ€§çš„è³¼ç‰©å¤©å ‚ã€‚", hours: "10:00 - 23:00", price: "å…è²»", bestTime: "å‚æ™š 17:00 å¾Œ", tips: ["è¡—é‚Šå°åƒå»ºè­°æº–å‚™ç¾é‡‘", "ç¾å¦ä¿é¤Šå“æœ€é½Šå…¨"], query: "Myeongdong Shopping Street" },
            { title: "æ¨‚å¤©ä¸–ç•Œ", krName: "ë¡¯ë°ì›”ë“œ", tag: "ä¸»é¡Œæ¨‚åœ’", desc: "å…¨çƒæœ€å¤§çš„å®¤å…§ä¸»é¡Œæ¨‚åœ’ä¹‹ä¸€ã€‚", hours: "10:00 - 21:00", price: "æˆäººç´„ â‚©62,000", bestTime: "å¹³æ—¥é–‹åœ’æ™‚", tips: ["å»ºè­°ä¸‹è¼‰ Magic Pass APP", "å®¤å…§é©åˆæ‹ç…§"], query: "Lotte World" },
            { title: "æ˜Ÿç©ºåœ–æ›¸é¤¨", krName: "ë³„ë§ˆë‹¹ë„ì„œê´€", tag: "ç¶²ç¾æ™¯é»", desc: "ä½æ–¼ COEX Mall å…§çš„å·¨å‹é–‹æ”¾å¼åœ–æ›¸é¤¨ã€‚", hours: "10:30 - 22:00", price: "å…è²»", bestTime: "æ—©ä¸Šå‰›é–‹é–€æˆ–æ™šä¸Šé»ç‡ˆå¾Œ", tips: ["ä½æ–¼ COEX Mall åœ°ä¸‹ä¸€æ¨“", "æ­ä¹˜æ‰‹æ‰¶æ¢¯æ™‚æ˜¯æœ€ä½³çš„æ‹æ”è§’åº¦"], query: "Starfield Library COEX" },
            { title: "å¤§æ˜ç¶­ç“¦çˆ¾åœ°", krName: "ë¹„ë°œë””íŒŒí¬", tag: "æ»‘é›ªåº¦å‡", desc: "è·é›¢é¦–çˆ¾æœ€è¿‘çš„å¤§å‹æ»‘é›ªåº¦å‡æ‘ã€‚", hours: "08:30 - 22:30", price: "ä¾æ»‘é›ªé€šç¥¨æ–¹æ¡ˆè€Œå®š", bestTime: "12æœˆè‡³2æœˆ", tips: ["Snowy Land é©åˆè¦ªå­", "å»ºè­°åƒåŠ ä¸€æ—¥åœ˜"], query: "Vivaldi Park Ski World" }
        ];

        function renderGuide() {
            const container = document.getElementById('guideContent');
            container.innerHTML = '';
            guideData.forEach(item => {
                const card = document.createElement('div');
                card.className = "bg-white rounded-2xl overflow-hidden shadow-sm border border-gray-100";
                const tipsHtml = item.tips.map(tip => `<li class="flex items-start gap-2 text-sm text-gray-600 mb-1"><span class="text-blue-500 mt-1.5 text-[6px]"><i class="fa-solid fa-circle"></i></span><span class="flex-1">${tip}</span></li>`).join('');
                card.innerHTML = `
                    <div class="p-5">
                        <div class="flex items-start justify-between mb-2">
                            <div><h3 class="text-xl font-bold text-gray-800">${item.title} <span class="text-sm font-normal text-gray-400 ml-1">${item.krName}</span></h3></div>
                            <span class="bg-gray-100 text-gray-500 text-xs px-2 py-1 rounded-full font-bold whitespace-nowrap">${item.tag}</span>
                        </div>
                        <p class="text-sm text-gray-600 leading-relaxed mb-4 text-justify">${item.desc}</p>
                        <div class="bg-gray-50 rounded-xl p-4 grid gap-3 mb-4 border border-gray-100">
                            <div class="flex items-start gap-3"><div class="w-5 flex justify-center mt-0.5"><i class="fa-regular fa-clock text-gray-400"></i></div><div><div class="text-xs text-gray-400 font-bold uppercase tracking-wider">é–‹æ”¾æ™‚é–“</div><div class="text-sm font-medium text-gray-800">${item.hours}</div></div></div>
                            <div class="flex items-start gap-3"><div class="w-5 flex justify-center mt-0.5"><i class="fa-solid fa-ticket text-gray-400"></i></div><div><div class="text-xs text-gray-400 font-bold uppercase tracking-wider">é–€ç¥¨åƒ¹æ ¼</div><div class="text-sm font-medium text-gray-800">${item.price}</div></div></div>
                            <div class="flex items-start gap-3"><div class="w-5 flex justify-center mt-0.5"><i class="fa-regular fa-calendar-check text-gray-400"></i></div><div><div class="text-xs text-gray-400 font-bold uppercase tracking-wider">æœ€ä½³åƒè§€æ™‚é–“</div><div class="text-sm font-medium text-gray-800">${item.bestTime}</div></div></div>
                        </div>
                        
                        <!-- Google Maps Embed -->
                        <div class="relative h-48 rounded-xl overflow-hidden mb-4 shadow-inner bg-gray-100">
                            <iframe 
                                width="100%" 
                                height="100%" 
                                frameborder="0" 
                                style="border:0" 
                                src="https://maps.google.com/maps?q=${encodeURIComponent(item.query)}&t=&z=15&ie=UTF8&iwloc=&output=embed" 
                                allowfullscreen>
                            </iframe>
                        </div>

                        <div class="bg-blue-50/50 rounded-xl p-4 border border-blue-100 mb-4">
                            <div class="flex items-center gap-2 mb-2"><div class="w-2 h-2 rounded-full bg-blue-500"></div><h4 class="font-bold text-blue-600 text-sm">å¯¦ç”¨å°æé†’</h4></div>
                            <ul class="">${tipsHtml}</ul>
                        </div>
                        <a href="https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(item.query)}" target="_blank" class="block w-full bg-pink-400 text-white text-center py-3 rounded-xl font-bold hover:bg-pink-500 transition shadow-sm active:scale-[0.98]"><i class="fa-solid fa-map-location-dot mr-1"></i> åœ¨ Google Map æŸ¥çœ‹</a>
                    </div>`;
                container.appendChild(card);
            });
        }

        // --- 4. Info Tab Logic ---
        const emergencyContacts = [
            { name: "è­¦å¯Ÿ", number: "112", icon: "fa-phone", color: "text-blue-600" },
            { name: "æ¶ˆé˜²/æ•‘è­·è»Š", number: "119", icon: "fa-phone", color: "text-red-600" },
            { name: "å°åŒ—é§éŸ“ä»£è¡¨è™•", number: "+82-2-399-2767", icon: "fa-map-pin", color: "text-pink-500" },
            { name: "å¤–äº¤éƒ¨æ€¥é›£æ•‘åŠ©", number: "+886-800-085-095", icon: "fa-phone", color: "text-orange-600" }
        ];
        const weatherLinks = [
            { name: "éŸ“åœ‹æ°£è±¡å»³", url: "https://www.weather.go.kr/w/index.do", desc: "å®˜æ–¹æ°£è±¡è³‡è¨Š" },
            { name: "é¦–çˆ¾å¤©æ°£é å ±", url: "https://www.accuweather.com/zh/kr/seoul/226081/weather-forecast/226081", desc: "AccuWeather 15å¤©é å ±" }
        ];
        const travelTips = [
            { title: "äº¤é€šç¦®å„€", items: ["åœ°éµåšæ„›åº§ä¸è¦åï¼ˆå³ä½¿ç©ºä½å¾ˆå¤šï¼‰", "æ‰‹æ‰¶æ¢¯é å³ç«™ï¼Œå·¦å´ç•™çµ¦è¶•æ™‚é–“çš„äºº", "åœ°éµä¸Šä¸è¦å¤§è²è¬›é›»è©±", "è¨ˆç¨‹è»Šå¾Œåº§è¦ç¹«å®‰å…¨å¸¶ï¼ˆæœ‰è¦å®šï¼‰"] },
            { title: "ç”¨é¤ç¦®å„€", items: ["å¹´é•·è€…å…ˆå‹•ç­·æ‰èƒ½é–‹å§‹åƒ", "ä¸è¦æŠŠç­·å­æ’åœ¨é£¯ä¸Šï¼ˆåƒç¥­æ‹œï¼‰", "å–é…’æ™‚è¦å´èº«ã€ç”¨æ‰‹é®", "å°èœå…è²»çºŒï¼Œä½†ä¸è¦æµªè²»"] },
            { title: "ç”Ÿæ´»å°å¸¸è­˜", items: ["ä¾¿åˆ©å•†åº—æœ‰ç†±æ°´æ©Ÿå¯è£ç†±æ°´", "å¤§éƒ¨åˆ†åº—å®¶æœ‰å…è²»Wi-Fi", "åƒåœ¾è¦åˆ†é¡ï¼Œè·¯ä¸Šå¾ˆå°‘åƒåœ¾æ¡¶", "å®¤å…§é€šå¸¸é–‹å¾ˆå¼·çš„æš–æ°£ï¼Œæ´‹è”¥å¼ç©¿æ³•æœ€å¥½"] }
        ];
        const appRecommendations = [
            { name: "Kakao Map", desc: "å°èˆªå¿…å‚™" }, { name: "Papago", desc: "ç¿»è­¯ç¥å™¨" },
            { name: "Kakao Talk", desc: "ç•¶åœ°é€šè¨Š" }, { name: "Subway Korea", desc: "åœ°éµæŸ¥è©¢" }
        ];
        const smartPassSteps = [
            "ä¸‹è¼‰ Smart Pass App (iOS/Android)", "é¸æ“‡èªè¨€ï¼ˆç°¡é«”ä¸­æ–‡ï¼‰", "åŒæ„æ¢æ¬¾ã€é€²è¡Œä¿¡ç®±èªè­‰",
            "è¨­å®šå¿«é€Ÿå¯†ç¢¼ (æ—¥å¾Œå¯ç”¨ç”Ÿç‰©è¾¨è­˜)", "ç™»éŒ„è­·ç…§èˆ‡è‡‰éƒ¨ (éœ€æƒææ™¶ç‰‡)", "ç™»éŒ„ç™»æ©Ÿè­‰/æ©Ÿç¥¨"
        ];
        const smartPassFaqs = [
            { q: "å…’ç«¥å¯ä»¥ä½¿ç”¨å—ï¼Ÿ", a: "7æ­²ä»¥ä¸‹ç„¡æ³•ä½¿ç”¨ï¼Œæœªæ»¿14æ­²éœ€ç›£è­·äººåŒæ„ã€‚" },
            { q: "åªæœ‰ä»å·æ©Ÿå ´å¯ä»¥ä½¿ç”¨å—ï¼Ÿ", a: "æ˜¯çš„ï¼Œç›®å‰åƒ…é™ä»å·æ©Ÿå ´æœ‰ Smart Pass æ¨™ç¤ºçš„é–˜å£ã€‚" },
            { q: "ä¸‹æ¬¡é›¢é–‹éŸ“åœ‹é‚„èƒ½ç”¨å—ï¼Ÿ", a: "è­·ç…§èˆ‡è‡‰éƒ¨è³‡è¨Šæ•ˆæœŸ5å¹´ï¼Œä½†æ¯æ¬¡éœ€é‡æ–°ç™»éŒ„æ©Ÿç¥¨ã€‚" },
            { q: "è­·ç…§æ›´æ›éœ€é‡æ–°ç™»éŒ„å—ï¼Ÿ", a: "éœ€è¦ï¼Œè«‹åˆªé™¤Appå¾Œé‡æ–°è¨»å†Šï¼ˆå¯ç”¨åŒä¸€ä¿¡ç®±ï¼‰ã€‚" },
            { q: "Smart Pass å°±æ˜¯è‡ªå‹•é€šé—œå—ï¼Ÿ", a: "ä¸æ˜¯ï¼Smart Pass æ˜¯å‡ºå¢ƒå‰çš„äººè‡‰è¾¨è­˜ï¼Œèˆ‡æµ·é—œè‡ªå‹•é€šé—œï¼ˆSeSï¼‰ä¸åŒã€‚" }
        ];

        function renderInfo() {
            const emergencyList = document.getElementById('emergencyList');
            if (emergencyList) {
                emergencyList.innerHTML = emergencyContacts.map(c => `
                    <a href="tel:${c.number}" class="flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors border border-gray-100">
                        <div class="flex items-center gap-3">
                            <i class="fa-solid ${c.icon} ${c.color} w-5 text-center"></i>
                            <div><div class="font-bold text-gray-800">${c.name}</div><div class="text-sm text-gray-500">${c.number}</div></div>
                        </div>
                        <i class="fa-solid fa-phone text-gray-300"></i>
                    </a>
                `).join('');
            }

            const weatherList = document.getElementById('weatherList');
            if (weatherList) {
                weatherList.innerHTML = weatherLinks.map(l => `
                    <a href="${l.url}" target="_blank" class="flex items-center justify-between p-3 bg-gradient-to-r from-blue-50 to-white rounded-lg hover:from-blue-100 hover:to-blue-50 transition-colors border border-blue-100">
                        <div><div class="font-bold text-gray-800">${l.name}</div><div class="text-sm text-gray-500">${l.desc}</div></div>
                        <i class="fa-solid fa-arrow-up-right-from-square text-blue-400"></i>
                    </a>
                `).join('');
            }

            const tipsList = document.getElementById('tipsList');
            if (tipsList) {
                tipsList.innerHTML = travelTips.map(t => `
                    <div class="p-4 shadow-sm rounded-xl border-2 border-gray-100 bg-white">
                        <h3 class="font-bold text-gray-800 mb-3 text-lg">${t.title}</h3>
                        <ul class="space-y-2">
                            ${t.items.map(i => `<li class="flex items-start gap-3 text-sm text-gray-600"><span class="text-pink-500 font-bold mt-0.5">â€¢</span><span class="flex-1">${i}</span></li>`).join('')}
                        </ul>
                    </div>
                `).join('');
            }

            const appList = document.getElementById('appList');
            if (appList) {
                appList.innerHTML = appRecommendations.map(a => `
                    <div class="bg-white p-3 rounded-lg text-center shadow-sm border border-white/50">
                        <div class="font-bold text-gray-800 text-sm">${a.name}</div>
                        <div class="text-xs text-gray-500 mt-1">${a.desc}</div>
                    </div>
                `).join('');
            }

            // Smart Pass Steps
            const spSteps = document.getElementById('smartPassSteps');
            if (spSteps) {
                spSteps.innerHTML = smartPassSteps.map((s, i) => `
                    <li class="flex items-start gap-3 text-sm text-gray-600">
                        <span class="flex-shrink-0 w-6 h-6 rounded-full bg-pink-500 text-white flex items-center justify-center text-xs font-bold">${i + 1}</span>
                        <div><span class="font-bold text-gray-800">${s}</span></div>
                    </li>
                `).join('');
            }

            // Smart Pass FAQ
            const faqList = document.getElementById('faqList');
            if (faqList) {
                faqList.innerHTML = smartPassFaqs.map(f => `
                    <details class="bg-gray-50 rounded-lg p-3 group">
                        <summary class="font-bold text-sm text-gray-800 cursor-pointer list-none flex justify-between items-center">
                            ${f.q}
                            <i class="fa-solid fa-chevron-down text-gray-400 group-open:rotate-180 transition-transform"></i>
                        </summary>
                        <p class="text-sm text-gray-600 mt-2 pl-2 border-l-2 border-pink-200">${f.a}</p>
                    </details>
                `).join('');
            }
        }

        // --- 5. Translation Logic (RESTORED) ---
        const translatePhrases = [
            { category: "åŸºæœ¬å•å€™", items: [ { zh: "ä½ å¥½", en: "Hello", ko: "ì•ˆë…•í•˜ì„¸ìš”", roman: "Annyeonghaseyo" }, { zh: "è¬è¬", en: "Thank you", ko: "æ„Ÿè¬í•©ë‹ˆë‹¤", roman: "Gamsahamnida" }, { zh: "ä¸å¥½æ„æ€", en: "Excuse me", ko: "ì£„ì†¡í•©ë‹ˆë‹¤", roman: "Joesonghamnida" } ] },
            { category: "è³¼ç‰©", items: [ { zh: "å¤šå°‘éŒ¢ï¼Ÿ", en: "How much?", ko: "ì–¼ë§ˆì˜ˆìš”?", roman: "Eolmayeyo?" }, { zh: "å¤ªè²´äº†", en: "Too expensive", ko: "ë„ˆë¬´ ë¹„ì‹¸ìš”", roman: "Neomu bissayo" }, { zh: "ä¾¿å®œä¸€é»", en: "Discount please", ko: "ê¹ì•„ ì£¼ì„¸ìš”", roman: "Kkakka juseyo" } ] },
            { category: "é¤å»³", items: [ { zh: "èœå–®", en: "Menu", ko: "ë©”ë‰´íŒ", roman: "Menupan" }, { zh: "æˆ‘è¦é»é¤", en: "Order please", ko: "ì£¼ë¬¸í• ê²Œìš”", roman: "Jumunhalgeyo" }, { zh: "çµå¸³", en: "Check please", ko: "ê³„ì‚°í• ê²Œìš”", roman: "Gyesanhalgeyo" } ] },
            { category: "æ»‘é›ªå¸¸ç”¨", items: [ { zh: "æ»‘é›ª", en: "Ski", ko: "ìŠ¤í‚¤", roman: "Seuki" }, { zh: "çºœè»Š", en: "Gondola", ko: "ê³¤ëŒë¼", roman: "Gondolla" }, { zh: "å¥½å†·", en: "So cold", ko: "ë„ˆë¬´ ì¶”ì›Œìš”", roman: "Neomu chuwoyo" } ] }
        ];

        async function handleRealTimeTranslate() {
            const inputText = document.getElementById('transInput').value.trim();
            const btn = document.getElementById('transBtn');
            const resultsDiv = document.getElementById('transResults');
            if (!inputText) return;
            btn.disabled = true;
            try {
                const koResponse = await fetch(`https://api.mymemory.translated.net/get?q=${encodeURIComponent(inputText)}&langpair=zh-TW|ko`);
                const koData = await koResponse.json();
                const enResponse = await fetch(`https://api.mymemory.translated.net/get?q=${encodeURIComponent(inputText)}&langpair=zh-TW|en`);
                const enData = await enResponse.json();
                document.getElementById('resKo').innerText = koData.responseData.translatedText;
                document.getElementById('resEn').innerText = enData.responseData.translatedText;
                resultsDiv.classList.remove('hidden');
            } catch {
                showToast("ç¿»è­¯å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦");
            } finally {
                btn.disabled = false;
            }
        }

        function renderPhrases() {
            const searchInput = document.getElementById('phraseSearch');
            if (!searchInput) return;
            const searchTerm = searchInput.value.toLowerCase();
            const container = document.getElementById('phraseContainer');
            container.innerHTML = '';
            
            const filteredData = translatePhrases.map(cat => ({ 
                ...cat, 
                items: cat.items.filter(item => item.zh.includes(searchTerm) || item.en.toLowerCase().includes(searchTerm)) 
            })).filter(cat => cat.items.length > 0);
            
            if (filteredData.length === 0) {
                container.innerHTML = `<div class="text-center text-gray-400 mt-10">æ‰¾ä¸åˆ°ç›¸é—œçµæœ</div>`;
                return;
            }

            filteredData.forEach(cat => {
                const card = document.createElement('div');
                card.className = "bg-white p-4 rounded-xl shadow-sm border-2 border-pink-50/50";
                card.innerHTML = `<h3 class="font-bold text-gray-800 mb-2 text-lg">${cat.category}</h3>`;
                const list = document.createElement('div');
                list.className = "space-y-2";
                cat.items.forEach(item => {
                    const row = document.createElement('div');
                    row.className = "p-2 bg-gray-50 rounded-lg flex justify-between items-center";
                    row.innerHTML = `<div class="flex-1"><div class="font-bold">${item.zh}</div><div class="text-xs text-gray-400">${item.en}</div><div class="text-pink-600 font-bold">${item.ko}</div></div><button onclick="speak('${item.ko}')" class="text-pink-400 p-2"><i class="fa-solid fa-volume-high"></i></button>`;
                    list.appendChild(row);
                });
                card.appendChild(list);
                container.appendChild(card);
            });
        }

        function speak(text) {
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = "ko-KR";
                window.speechSynthesis.speak(utterance);
            } else {
                showToast("ç€è¦½å™¨ä¸æ”¯æ´ç™¼éŸ³");
            }
        }
        function speakResult() {
             const text = document.getElementById('resKo').innerText;
             if(text) speak(text);
        }

        // --- 6. Expense Tracker Logic (RESTORED) ---
        let expenses = [];
        let exchangeRate = 0.024;
        let currentPhoto = null;

        function initExpenseView() {
            const savedExpenses = localStorage.getItem("travel-expenses");
            const savedRate = localStorage.getItem("exchange-rate");
            if (savedExpenses) expenses = JSON.parse(savedExpenses);
            if (savedRate) {
                exchangeRate = parseFloat(savedRate);
                const rateInput = document.getElementById('exchangeRateInput');
                if (rateInput) rateInput.value = exchangeRate;
            }
            renderExpenses();
        }

        function saveExchangeRate(val) {
            exchangeRate = parseFloat(val) || 0.024;
            localStorage.setItem("exchange-rate", exchangeRate.toString());
            renderExpenses(); 
            showToast("åŒ¯ç‡å·²æ›´æ–°ï¼");
        }

        function calculate() {
            const input = document.getElementById('calcInput').value;
            if (!input) return;
            try {
                const safeInput = input.replace(/[^0-9+\-*/.()]/g, "");
                const result = new Function('return ' + safeInput)();
                document.getElementById('calcResultKrw').innerText = `â‚©${result.toLocaleString()}`;
                document.getElementById('calcResultTwd').innerText = `ç´„ NT$ ${Math.round(result * exchangeRate).toLocaleString()}`;
                document.getElementById('calcResultContainer').classList.remove('hidden');
                showToast("è¨ˆç®—å®Œæˆ");
            } catch (e) {
                showToast("ç®—å¼æ ¼å¼éŒ¯èª¤");
            }
        }

        function handlePhotoSelect(input) {
            if (input.files && input.files[0]) {
                compressImage(input.files[0]).then(base64 => {
                    currentPhoto = base64;
                    document.getElementById('imagePreview').src = base64;
                    document.getElementById('imagePreviewContainer').classList.remove('hidden');
                }).catch(() => showToast("ç…§ç‰‡è™•ç†å¤±æ•—"));
            }
        }

        function clearPhoto() {
            currentPhoto = null;
            document.getElementById('photoInput').value = '';
            document.getElementById('imagePreviewContainer').classList.add('hidden');
        }

        function compressImage(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = (event) => {
                    const img = new Image();
                    img.src = event.target.result;
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        const MAX_WIDTH = 400;
                        const MAX_HEIGHT = 400;
                        let width = img.width;
                        let height = img.height;
                        if (width > height) {
                            if (width > MAX_WIDTH) { height *= MAX_WIDTH / width; width = MAX_WIDTH; }
                        } else {
                            if (height > MAX_HEIGHT) { width *= MAX_HEIGHT / height; height = MAX_HEIGHT; }
                        }
                        canvas.width = width;
                        canvas.height = height;
                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(img, 0, 0, width, height);
                        resolve(canvas.toDataURL('image/jpeg', 0.7));
                    };
                    img.onerror = reject;
                };
                reader.onerror = reject;
            });
        }

        function handleAddExpense() {
            const name = document.getElementById('exName').value;
            const amountStr = document.getElementById('exAmount').value;
            if (!name || !amountStr) {
                showToast("è«‹è¼¸å…¥åç¨±å’Œé‡‘é¡");
                return;
            }
            const krw = parseFloat(amountStr);
            const newExpense = {
                id: Date.now().toString(),
                item: name,
                krw: krw,
                photo: currentPhoto,
                date: new Date().toLocaleString("zh-TW", { month: 'numeric', day: 'numeric', hour: '2-digit', minute:'2-digit' })
            };
            expenses.unshift(newExpense);
            localStorage.setItem("travel-expenses", JSON.stringify(expenses));
            document.getElementById('exName').value = '';
            document.getElementById('exAmount').value = '';
            clearPhoto();
            renderExpenses();
            showToast("è¨˜å¸³æˆåŠŸï¼");
        }

        function deleteExpense(id) {
            if(confirm('ç¢ºå®šè¦åˆªé™¤å—ï¼Ÿ')) {
                expenses = expenses.filter(e => e.id !== id);
                localStorage.setItem("travel-expenses", JSON.stringify(expenses));
                renderExpenses();
                showToast("å·²åˆªé™¤");
            }
        }

        function clearExpenses() {
            if(confirm('ç¢ºå®šè¦æ¸…ç©ºæ‰€æœ‰è³‡æ–™å—ï¼Ÿ')) {
                expenses = [];
                localStorage.removeItem("travel-expenses");
                renderExpenses();
                showToast("è³‡æ–™å·²æ¸…ç©º");
            }
        }

        function renderExpenses() {
            const listEl = document.getElementById('expenseList');
            const emptyEl = document.getElementById('emptyExpenseState');
            if (!listEl || !emptyEl) return;

            const totalKrw = expenses.reduce((sum, item) => sum + item.krw, 0);
            const totalTwd = Math.round(totalKrw * exchangeRate);
            
            const totalKrwEl = document.getElementById('totalKrwDisplay');
            const totalTwdEl = document.getElementById('totalTwdDisplay');
            if (totalKrwEl) totalKrwEl.innerText = `â‚©${totalKrw.toLocaleString()}`;
            if (totalTwdEl) totalTwdEl.innerText = `NT$ ${totalTwd.toLocaleString()}`;

            if (expenses.length === 0) {
                emptyEl.classList.remove('hidden');
                listEl.innerHTML = '';
            } else {
                emptyEl.classList.add('hidden');
                listEl.innerHTML = expenses.map(item => {
                    const itemTwd = Math.round(item.krw * exchangeRate);
                    return `
                        <div class="bg-white p-3 rounded-xl shadow-sm border border-gray-100 flex gap-3 animate-fade-in-up">
                            ${item.photo ? `<img src="${item.photo}" class="w-16 h-16 rounded-lg object-cover border border-gray-100 flex-shrink-0">` : 
                                `<div class="w-16 h-16 rounded-lg bg-gray-100 flex items-center justify-center text-gray-400 flex-shrink-0"><i class="fa-solid fa-receipt text-xl"></i></div>`}
                            <div class="flex-1 min-w-0">
                                <div class="flex justify-between items-start">
                                    <h4 class="font-bold text-gray-800 truncate">${item.item}</h4>
                                    <button onclick="deleteExpense('${item.id}')" class="text-gray-300 hover:text-red-500 transition"><i class="fa-solid fa-trash-can"></i></button>
                                </div>
                                <div class="text-pink-500 font-bold mt-1">â‚©${item.krw.toLocaleString()}</div>
                                <div class="flex justify-between items-end mt-1">
                                    <div class="text-xs text-gray-500">ç´„ NT$ ${itemTwd}</div>
                                    <div class="text-xs text-gray-300">${item.date}</div>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
            }
        }

        function showToast(message) {
            const toast = document.getElementById("toast");
            if (toast) {
                toast.className = "show";
                toast.innerText = message;
                setTimeout(function(){ toast.className = toast.className.replace("show", ""); }, 3000);
            }
        }

        function toggleInfoModal() {
            document.getElementById('infoModal').classList.toggle('hidden');
        }

        // --- Init ---
        // Ensure DOM is fully loaded before rendering
        document.addEventListener('DOMContentLoaded', () => {
            renderTabs();
            renderItinerary();
            renderGuide();
            renderPhrases();
            renderInfo();
            initExpenseView();
        });

    </script>
</body>
</html>